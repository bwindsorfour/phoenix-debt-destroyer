<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phoenix Debt Destroyer - Automated Payoff Calculator</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Use Inter font family -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        .input-field {
            /* Ensured explicit colors for dark mode visibility */
            @apply w-full p-3 bg-gray-700 text-white border border-gray-600 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out;
            /* FORCED FIX: Overriding browser defaults for dark background/white text */
            background-color: #4A5568 !important; /* Tailwind gray-700 */
            color: #FFFFFF !important;
        }
        /* FORCED FIX: Placeholder text visibility */
        .input-field::placeholder {
            color: #A0AEC0 !important; /* Tailwind gray-400 */
        }
        .metric-card {
            @apply bg-gray-800 p-4 rounded-xl shadow-lg border-t-4 border-blue-500;
        }
        /* Custom scrollbar for debt list */
        .debt-list-container::-webkit-scrollbar {
            width: 8px;
        }
        .debt-list-container::-webkit-scrollbar-thumb {
            background: #4A5568;
            border-radius: 10px;
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen p-4 sm:p-8">

    <div class="max-w-7xl mx-auto">
        <header class="text-center mb-10">
            <h1 class="text-4xl sm:text-5xl font-extrabold text-blue-400">ðŸ”¥ Phoenix Debt Destroyer ðŸ”¥</h1>
            <p class="mt-2 text-xl text-gray-300">Automate your path to zero debt. High automation, zero guesswork.</p>
        </header>

        <!-- Main Grid Layout -->
        <main class="grid lg:grid-cols-3 gap-8">
            
            <!-- COLUMN 1: Debt Input Form -->
            <div class="lg:col-span-1 bg-gray-800 p-6 rounded-2xl shadow-2xl h-fit">
                <h2 class="text-2xl font-bold mb-6 text-blue-300">Add New Debt</h2>
                <form id="debt-form" class="space-y-4">
                    <div>
                        <label for="name" class="block text-sm font-medium text-gray-300 mb-1">Debt Name</label>
                        <input type="text" id="name" placeholder="e.g., Credit Card A" class="input-field" required>
                    </div>
                    <div>
                        <label for="balance" class="block text-sm font-medium text-gray-300 mb-1">Current Balance ($)</label>
                        <input type="number" id="balance" placeholder="2500.00" class="input-field" step="0.01" min="0" required>
                    </div>
                    <div>
                        <label for="interest" class="block text-sm font-medium text-gray-300 mb-1">Interest Rate (APY, %)</label>
                        <input type="number" id="interest" placeholder="18.5" class="input-field" step="0.1" min="0" required>
                    </div>
                    <div>
                        <label for="minPayment" class="block text-sm font-medium text-gray-300 mb-1">Minimum Monthly Payment ($)</label>
                        <input type="number" id="minPayment" placeholder="50.00" class="input-field" step="0.01" min="0" required>
                    </div>
                    <div>
                        <label for="extraPayment" class="block text-sm font-medium text-gray-300 mb-1">Extra Monthly Payment to Apply ($)</label>
                        <input type="number" id="extraPayment" value="0" class="input-field" step="0.01" min="0" required>
                    </div>
                    <!-- Submit button is now always enabled -->
                    <button type="submit" id="submit-debt-btn" class="w-full py-3 bg-blue-600 hover:bg-blue-700 text-white font-bold text-lg rounded-xl transition duration-150 ease-in-out shadow-lg shadow-blue-500/50">
                        Add Debt
                    </button>
                </form>
            </div>

            <!-- COLUMN 2: Debt List & Control -->
            <div class="lg:col-span-2 space-y-8">
                <div class="bg-gray-800 p-6 rounded-2xl shadow-2xl">
                    <h2 class="text-2xl font-bold mb-4 text-blue-300">Your Debts (Browser Storage)</h2>
                    <p id="auth-status" class="text-sm text-green-500 mb-4">Ready to use! Data saved locally in this browser.</p>
                    <div id="debt-list" class="debt-list-container max-h-80 overflow-y-auto space-y-3">
                        <!-- Debts will be rendered here -->
                        <p id="no-debts" class="text-gray-400">No debts added yet. Use the form to the left!</p>
                    </div>
                </div>

                <!-- COLUMN 2: Dashboard Controls -->
                <div class="bg-gray-800 p-6 rounded-2xl shadow-2xl">
                    <h2 class="text-2xl font-bold mb-4 text-blue-300">Payoff Strategy & Results</h2>
                    <div class="flex flex-col sm:flex-row gap-4 mb-6">
                        <button id="snowball-btn" class="w-full sm:w-1/2 py-3 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-xl transition duration-150 ease-in-out shadow-md shadow-red-500/50">
                            Apply Debt Snowball (Low-to-High Balance)
                        </button>
                        <button id="avalanche-btn" class="w-full sm:w-1/2 py-3 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-xl transition duration-150 ease-in-out shadow-md shadow-green-500/50">
                            Apply Debt Avalanche (High-to-Low Interest)
                        </button>
                    </div>

                    <!-- Calculation Output -->
                    <div id="results-dashboard" class="mt-8 space-y-6">
                        <div class="grid md:grid-cols-3 gap-4">
                            <div class="metric-card">
                                <p class="text-sm text-gray-400">Strategy Selected</p>
                                <p id="strategy-name" class="text-2xl font-bold text-yellow-300 mt-1" data-active-method="">None</p>
                            </div>
                            <div class="metric-card">
                                <p class="text-sm text-gray-400">Estimated Payoff Date</p>
                                <p id="payoff-date" class="text-2xl font-bold text-blue-300 mt-1">N/A</p>
                            </div>
                            <div class="metric-card">
                                <p class="text-sm text-gray-400">Total Interest Paid</p>
                                <p id="total-interest" class="text-2xl font-bold text-red-400 mt-1">N/A</p>
                            </div>
                        </div>

                        <div class="bg-gray-700 p-4 rounded-lg">
                            <p class="text-lg font-semibold text-gray-200">Total Debt Burden</p>
                            <p id="total-debt" class="text-3xl font-extrabold text-white mt-1">$0.00</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Debugging/User Info Section -->
        <footer class="mt-10 text-center text-xs text-gray-500">
            <p>Data is stored locally in your browser. It will **not** sync between devices.</p>
        </footer>
    </div>

    <script type="module">
        
        // --- LOCAL DATA PERSISTENCE FUNCTIONS ---
        const DEBT_STORAGE_KEY = 'phoenixDebtList';
        let debts = [];

        const loadDebts = () => {
            const storedData = localStorage.getItem(DEBT_STORAGE_KEY);
            if (storedData) {
                try {
                    debts = JSON.parse(storedData);
                } catch (e) {
                    console.error("Error parsing stored debt data:", e);
                    debts = [];
                }
            }
            renderDebtList();
            calculateAndDisplayResults();
        };

        const saveDebts = () => {
            localStorage.setItem(DEBT_STORAGE_KEY, JSON.stringify(debts));
        };
        
        // --- UTILITY FUNCTIONS ---

        const formatCurrency = (amount) => {
            return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 2 }).format(amount);
        };

        const formatDate = (date) => {
            return new Intl.DateTimeFormat('en-US', { year: 'numeric', month: 'long' }).format(date);
        };

        // --- DEBT PAYOFF LOGIC (CORE ENGINE) ---

        /**
         * Calculates payoff for multiple debts using Snowball or Avalanche method.
         * (Logic remains identical to the previous version, using local data structure)
         * @param {string} method - 'snowball' or 'avalanche'.
         * @param {number} extraPayment - Extra money allocated to be added to the target debt.
         * @returns {{payoffDate: string, totalInterest: number, method: string}}
         */
        const calculateStrategyPayoff = (method, extraPayment) => {
            if (debts.length === 0) return { payoffDate: 'N/A', totalInterest: 0, method: 'None' };

            // 1. Prepare and Sort Debts
            let debtList = JSON.parse(JSON.stringify(debts)); // Deep copy
            debtList.forEach(d => { d.interestRate /= 100; }); // Convert % to decimal

            if (method === 'snowball') {
                // Snowball: Lowest balance first
                debtList.sort((a, b) => a.balance - b.balance);
            } else if (method === 'avalanche') {
                // Avalanche: Highest interest rate first
                debtList.sort((a, b) => b.interestRate - a.interestRate);
            }
            
            // 2. Initialize Variables
            let currentExtraPayment = extraPayment; // This "snowball" will grow
            let currentDate = new Date();
            let totalInterestPaid = 0;
            let activeDebts = debtList.map(d => ({ ...d, currentBalance: d.balance }));

            let monthCounter = 0;
            const maxMonths = 1200; // Safety break

            // 3. Main Payoff Loop
            while (activeDebts.some(d => d.currentBalance > 0) && monthCounter < maxMonths) {
                monthCounter++;
                currentDate.setMonth(currentDate.getMonth() + 1);

                // Find the target debt (the first one still active, based on sorted order)
                const targetDebtIndex = activeDebts.findIndex(d => d.currentBalance > 0);
                
                if (targetDebtIndex === -1) break; // All paid off
                
                // Monthly payment allocation
                for (let i = 0; i < activeDebts.length; i++) {
                    let debt = activeDebts[i];
                    if (debt.currentBalance <= 0) continue;
                    
                    const monthlyRate = debt.interestRate / 12;
                    const interestPayment = debt.currentBalance * monthlyRate;
                    totalInterestPaid += interestPayment;

                    let payment = debt.minPayment;
                    
                    // If this is the current target debt, add the growing extra payment
                    if (i === targetDebtIndex) {
                        payment += currentExtraPayment;
                    }

                    // Determine the amount to pay towards principal
                    let principalPayment = payment - interestPayment;

                    if (debt.currentBalance + interestPayment <= payment) {
                        // Payoff month: Pay exactly the remaining balance + interest
                        principalPayment = debt.currentBalance;
                        debt.currentBalance = 0;
                        
                        // If paid off, add the debt's minimum payment to the growing extra payment (the "snowball" grows)
                        currentExtraPayment += debt.minPayment;
                        
                    } else {
                        // Standard payment month
                        debt.currentBalance -= principalPayment;
                    }
                }
            }

            return { 
                payoffDate: activeDebts.every(d => d.currentBalance <= 0) ? formatDate(currentDate) : 'Over 100 years', 
                totalInterest: totalInterestPaid, 
                method: method === 'snowball' ? 'Debt Snowball' : 'Debt Avalanche'
            };
        };


        // --- UI RENDERING & EVENT HANDLERS ---
        
        const renderDebtList = () => {
            const listContainer = document.getElementById('debt-list');
            listContainer.innerHTML = '';
            
            if (debts.length === 0) {
                listContainer.innerHTML = '<p id="no-debts" class="text-gray-400">No debts added yet. Use the form to the left!</p>';
                document.getElementById('total-debt').textContent = formatCurrency(0);
                return;
            }

            let totalDebtBalance = 0;

            debts.forEach((debt, index) => {
                totalDebtBalance += debt.balance;
                const div = document.createElement('div');
                div.className = 'bg-gray-700 p-3 rounded-lg flex justify-between items-center transition duration-150 ease-in-out hover:bg-gray-600';
                // Using the array index as a simple ID for local storage manipulation
                div.innerHTML = `
                    <div>
                        <p class="text-lg font-semibold text-white">${debt.name}</p>
                        <p class="text-sm text-gray-300">Balance: ${formatCurrency(debt.balance)} | Rate: ${debt.interestRate.toFixed(2)}% | Min Pay: ${formatCurrency(debt.minPayment)}</p>
                    </div>
                    <button data-index="${index}" class="delete-btn text-red-400 hover:text-red-500 font-bold ml-4 p-2 rounded-lg bg-gray-800 hover:bg-gray-700 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m1.23-7.5l-3.085 2.5a.5.5 0 00-.017.067L6 7l-2 11h16L18 7l-.017-.067A.5.5 0 0014.74 9z" />
                        </svg>
                    </button>
                `;
                listContainer.appendChild(div);
            });

            document.getElementById('total-debt').textContent = formatCurrency(totalDebtBalance);
            
            // Add event listeners for delete buttons
            listContainer.querySelectorAll('.delete-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const index = parseInt(e.currentTarget.dataset.index);
                    
                    // Simple local delete logic
                    debts.splice(index, 1); 
                    saveDebts();
                    renderDebtList();
                    calculateAndDisplayResults();
                });
            });
        };
        
        const calculateAndDisplayResults = (method = null) => {
            const extraPaymentInput = document.getElementById('extraPayment');
            const extraPaymentValue = parseFloat(extraPaymentInput.value) || 0;
            
            let strategy = { payoffDate: 'N/A', totalInterest: 0, method: 'None Selected' };

            const activeMethod = method || document.getElementById('strategy-name').dataset.activeMethod;
            
            if (debts.length === 0) {
                 document.getElementById('strategy-name').dataset.activeMethod = '';
                 strategy.payoffDate = 'N/A';
                 strategy.totalInterest = 0;
                 strategy.method = 'None';
            } else if (activeMethod && activeMethod !== 'None') {
                strategy = calculateStrategyPayoff(activeMethod, extraPaymentValue);
                document.getElementById('strategy-name').dataset.activeMethod = activeMethod;
            } else {
                // Initial load: Minimum Payment Baseline
                const baseline = calculateStrategyPayoff('avalanche', 0); 
                strategy.payoffDate = baseline.payoffDate; 
                strategy.totalInterest = baseline.totalInterest;
                strategy.method = 'Minimum Payment Only (Baseline)';
            }

            document.getElementById('strategy-name').textContent = strategy.method;
            document.getElementById('payoff-date').textContent = strategy.payoffDate;
            document.getElementById('total-interest').textContent = formatCurrency(strategy.totalInterest);
        };


        // --- MAIN APPLICATION SETUP ---

        document.getElementById('debt-form').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const newDebt = {
                name: document.getElementById('name').value,
                balance: parseFloat(document.getElementById('balance').value),
                interestRate: parseFloat(document.getElementById('interest').value),
                minPayment: parseFloat(document.getElementById('minPayment').value),
                extraPayment: parseFloat(document.getElementById('extraPayment').value || 0),
            };

            if (newDebt.balance <= 0 || newDebt.minPayment <= 0) {
                console.error("Please enter valid positive numbers for Balance and Minimum Payment.");
                return;
            }

            // Simple local add logic
            debts.push(newDebt);
            saveDebts();
            renderDebtList();
            calculateAndDisplayResults();

            e.target.reset(); // Clear form after successful submission
            document.getElementById('extraPayment').value = 0; // Resetting value
        });

        document.getElementById('snowball-btn').addEventListener('click', () => {
            calculateAndDisplayResults('snowball');
        });

        document.getElementById('avalanche-btn').addEventListener('click', () => {
            calculateAndDisplayResults('avalanche');
        });
        
        // Initial data load from browser storage
        loadDebts();
    </script>
</body>
</html>
